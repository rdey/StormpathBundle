services:
    redeye_stormpath.api_key_factory:
        class: Redeye\StormpathBundle\Factory\ApiKeyFactory
        public: false
        arguments:
            - %redeye_stormpath.api_key.id_property_name%
            - %redeye_stormpath.api_key.secret_property_name%

    redeye_stormpath.api_key:
        class: Stormpath\ApiKey
        public: false
        factory: [@redeye_stormpath.api_key_factory, createFromFile]
        arguments:
            - %redeye_stormpath.api_key.api_key_file%

    redeye_stormpath.client_factory:
        class: Redeye\StormpathBundle\Factory\ClientFactory
        public: false

    redeye_stormpath.client:
        class: Stormpath\Client
        factory: [@redeye_stormpath.client_factory, createClient]
        arguments:
            - @redeye_stormpath.api_key
            - %redeye_stormpath.client.cache_manager_class%
            - ~

    redeye_stormpath.tenant:
        class: Stormpath\Resource\Tenant
        factory_service: redeye_stormpath.client
        factory_method: getCurrentTenant

    redeye_stormpath.default_application.factory:
        class: Redeye\StormpathBundle\ApplicationFinder
        public: false

    redeye_stormpath.default_application:
        class: Stormpath\Resource\Application
        factory_service: redeye_stormpath.default_application.factory
        factory_method: getApplication
        arguments:
            - @redeye_stormpath.tenant
            - %redeye_stormpath.default_application_name%

    redeye_stormpath.id_site.url_builder:
        class: Redeye\StormpathBundle\IdSite\IdSiteUrlBuilder
        arguments:
            - @redeye_stormpath.api_key

    redeye_stormpath.id_site.callback_validator:
        class: Redeye\StormpathBundle\IdSite\IdSiteCallbackValidator
        arguments:
            - @redeye_stormpath.api_key
            - ~

    redeye_stormpath.id_site.token_store.stash:
        class: Redeye\StormpathBundle\TokenStore\StashTokenStore
        public: false
        arguments:
            - ~

    stormpath_tenant:
        alias: redeye_stormpath.tenant

    stormpath_application:
        alias: redeye_stormpath.default_application
